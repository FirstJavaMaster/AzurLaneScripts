# AzurLaneScripts

碧蓝航线的自动刷图脚本.

tips_1: 电脑需要安装python运行环境.
 
tips_2: 需要配合 安卓模拟器(推荐)/手机 使用.

tips_3: 这里仅讨论windows平台的使用.

tips_4: 默认读者已经有一定的动手能力.

**脚本还在完善中, 配置和运行方式都可能会(向着更简便更合理的方向)改变！！！
因此使用者每次更新代码请关注该文档的更新，运行时遇到错误先查阅文档说明，也可在issues中请求帮助。**

## 使用方法

原理是通过ADB对手机屏幕截图, 对比模板图片判断当前游戏情况, 然后通过ADB模拟点击/拖拽等操作.

### 环境搭建

#### 安装python

前往 [miniconda](https://docs.conda.io/en/latest/miniconda.html) 下载 python 3.7 安装包并安装.

安装时注意配置运行环境(path).

    如何判断python安装成功?
    
    打开cmd, 执行 `python --version`, 如果正确显示python版本号则说明安装成功

#### 安装python依赖

需要用户手动安装cv2, 用来处理图像相关的工作.

    pip install opencv-python

#### 关于ADB和设备

本项目已经自带了adb.exe程序. 用户不必再手动下载.

许多安卓模拟器也会自带adb程序, 不过其自带的版本往往比较低, 一些功能残缺. 因此程序默认使用自带的adb程序。

+ 需要用户查找当前模拟器的ADB连接端口。然后修改配置文件 `config.ini` 中 `adb_host_port` 配置
+ 支持多设备在线时指定某设备连接地址进行操作。但务必配置 `adb_host_port`

##### 模拟器使用分享

不同的模拟器在ADB的实现细节上不同，游戏的体验上也不同。下表是近期（2020-03）的一些体验。欢迎体验的小伙伴贡献经验。

| 模拟器 | ADB端口 | 游戏体验 | 备注（CPU等资源占用情况）    |
| ------ | ------- | -------- | ---------------------------- |
| 雷电   | 5555    | 3.5      | 占用未注意，掉帧相对严重     |
| 逍遥   | 21503   | 4.5      | 占用相对较低，偶尔会卡死     |
| MUMU   | 7555    | 4        | 占用和逍遥接近，声称不会卡死 |
| 夜神   | 62001   |          |
| 蓝叠   | 5555    |          |
| 天天   | 5037    |          |

> 注：游戏体验是指运行是否流畅，掉帧是否严重等情况。1~5分，分数越高体验相对越好。打分全凭个人感受。

> 注：模拟器卡顿掉帧并不一定是模拟器的问题，这游戏优化本来就不太好。在我安卓手机上（小米Note3）运行也跟雷电模拟器一样，60帧开起来跟没开一样。


### 配置文件

第一次下载本项目时，项目根目录有一个 `config_temp.ini` 配置文件。

这个文件介绍了该项目可进行的配置项，但项目的运行**不会**使用此配置文件！

用户需要将该配置文件拷贝一份并重命名为 `config.ini`，然后自行修改配置。**只有 `config.ini` 文件的配置才会生效。**

#### 一些配置项的说明

+ **auto_retire 自动退役**

`auto_retire`（自动退役）默认是**True**。在遇到船坞满员时，会进行“一键退役”功能。此时退役的船取决于碧蓝航线的自动推荐。退役完成后会继续执行战斗。

碧蓝航线的退役推荐默认不包括金船、布里、已被锁定的船，因此使用者想保留某些普通船时，将其锁定即可。

脚本在关卡战斗时发现**新船**时会自动锁定，因此不必担心新船被退役。


### 运行

打开游戏，进入关卡界面。比如：

![](./wiki/unit.png)

如果你想自动刷**4-4**关卡，则将**4-4**的关卡截一个图放到 `temp_images/target-stage` 下，如：

![](./wiki/4-4.png)

**注意：**

+ temp_images/target-stage 存放普通关卡的模板文件
+ temp_images/target-stage-hard 存放苦难关卡的模板文件

之所以分到两个文件夹是因为其模板图片在两种模式下往往是一样的，脚本会混淆两种模式。

然后运行 `Fight.py` 或 `FightToEnd.py` 等：

+ Fight.py 会根据 target_stage 目录下的模板文件寻找关卡，一直战斗。除非遇到“船坞满员（根据配置项可以自动退役）”，“没油”等情况。
+ FightHard.py 进行困难关卡的战斗
+ FightToEnd.py 只会在“已经处于某个关卡中”时才会进行战斗，战斗至关卡结束就会停止

战斗脚本都会自动判断是否已经在关卡中（寻敌界面），如果在就会立刻开始寻敌。因此用户可以手动点进一些特殊关卡，然后运行 `Fight.py` 用来通关。


